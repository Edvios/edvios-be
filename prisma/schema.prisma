generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
}

model Test {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("tests")
}

model User {
  id        String     @id
  firstName String?
  lastName  String?
  email     String     @unique
  role      UserRole   @default(STUDENT)
  status    UserStatus @default(ACTIVE)
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  phone     String?
  agent     Agent?
  student   Student?

  @@map("users")
}

model Student {
  id                       String            @id
  nationality              String?
  currentEducationLevel    String?
  currentInstitution       String?
  fieldOfStudy             String?
  gpa                      Float?
  graduationDate           DateTime?
  preferredDestination     String?
  preferredProgram         String?
  preferredStudyLevel      StudyLevel?
  preferredIntake          String?
  englishTest              String?
  englishScore             String?
  hasValidPassport         Boolean           @default(false)
  hasAcademicTranscripts   Boolean           @default(false)
  hasRecommendationLetters Boolean           @default(false)
  hasPersonalStatement     Boolean           @default(false)
  workExperience           String?
  extraCurricular          String?
  careerGoals              String?
  referralSource           String?
  preferredContactMethod   String?
  bestTimeToContact        String?
  additionalQuestions      String?
  budgetRange              String?
  currentCity              String?
  currentCountry           String?
  dob                      DateTime?
  marketingConsent         Boolean           @default(false)
  scholarshipInterest      Boolean           @default(false)
  createdAt                DateTime          @default(now())
  email                    String?           @unique
  firstName                String?
  lastName                 String?
  phone                    String?
  address                  String?
  applications             Application[]
  agentAssignment          AgentAssignment[]
  user                     User              @relation(fields: [id], references: [id], onDelete: Cascade)

  @@map("students")
}

model Agent {
  id              String            @id
  isSelected     Boolean           @default(false)
  country         String
  city            String
  state           String
  companyName     String?
  comment         String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  user            User              @relation(fields: [id], references: [id], onDelete: Cascade)
  agentAssignment AgentAssignment[]

  @@map("agents")
}

model Institution {
  id                    String            @id @default(uuid())
  name                  String
  type                  InstitutionType
  country               String
  city                  String
  ranking               Int
  establishedYear       Int
  totalStudents         Int
  internationalStudents Int
  programsCount         Int
  tuitionRange          String
  status                InstitutionStatus
  partnership           PartnershipType
  contactEmail          String
  website               String
  logo                  String?
  description           String
  specialties           String[]
  accreditations        String[]
  createdAt             DateTime          @default(now())
  updatedAt             DateTime          @updatedAt
  programs              Program[]
}

model Program {
  id                  String        @id @default(uuid())
  title               String
  duration            String
  tuitionFee          String
  applicationFee      String
  englishTestScore    String
  scholarship         Boolean
  lastUpdated         DateTime
  applicationDeadline DateTime
  ucasCode            String?
  englishWaiver       Boolean
  popularityRank      Int
  status              ProgramStatus
  institutionId       String
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  intakeId            String?
  subjectId           String?
  level               StudyLevel
  institution         Institution   @relation(fields: [institutionId], references: [id], onDelete: Cascade)
  intake              Intake?       @relation(fields: [intakeId], references: [id], onDelete: Cascade)
  subject             Subject?      @relation(fields: [subjectId], references: [id], onDelete: Cascade)
  applications        Application[]

  @@index([institutionId])
}

model Subject {
  id        String    @id @default(uuid())
  name      String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  programs  Program[]

  @@map("subjects")
}

model Intake {
  id           String        @id @default(uuid())
  name         String        @unique
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  programs     Program[]
  applications Application[]

  @@map("intakes")
}

model AgentAssignment {
  id        String        @id @default(uuid())
  studentId String
  agentId   String
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt
  messages  ChatMessage[]
  agent     Agent         @relation(fields: [agentId], references: [id], onDelete: Cascade)
  student   Student       @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([studentId, agentId])
  @@map("chats")
}

model ChatMessage {
  id              String          @id @default(uuid())
  chatId          String
  senderId        String
  senderRole      UserRole
  content         String
  status          MessageStatus   @default(SENT)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  attachmentName  String?
  attachmentSize  Int?
  attachmentType  String?
  attachmentUrl   String?
  agentAssignment AgentAssignment @relation(fields: [chatId], references: [id], onDelete: Cascade)

  @@index([chatId])
  @@index([senderId])
  @@map("chat_messages")
}

model Application {
  id                String            @id @default(uuid())
  studentId         String
  programId         String
  status            ApplicationStatus @default(SUBMITTED)
  additionalNotes   String?
  preferredIntakeId String?
  academicYear      String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  preferredIntake   Intake?           @relation(fields: [preferredIntakeId], references: [id])
  program           Program           @relation(fields: [programId], references: [id], onDelete: Cascade)
  student           Student           @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@index([studentId])
  @@index([programId])
  @@map("applications")
}

model StudentNotification {
  id        String   @id @default(uuid())
  message   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("student_notifications")
}

model AgentNotification {
  id        String   @id @default(uuid())
  message   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("agent_notifications")
}

enum UserRole {
  SUPER_ADMIN
  ADMIN
  AGENT
  STUDENT
  PENDING_AGENT
  REJECTED_AGENT
  SELECTED_AGENT
}

enum UserStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum ApplicationStatus {
  DRAFT
  SUBMITTED
  UNDER_REVIEW
  ACCEPTED
  REJECTED
  WITHDRAWN
}

enum StudyLevel {
  BACHELORS
  MASTERS
  PHD
  DIPLOMA
  CERTIFICATE
}

enum InstitutionType {
  UNIVERSITY
  COLLEGE
  SCHOOL
  INSTITUTE
}

enum InstitutionStatus {
  ACTIVE
  PENDING
  INACTIVE
}

enum PartnershipType {
  PREMIUM
  STANDARD
  BASIC
}

enum ProgramStatus {
  AVAILABLE
  DEADLINE_PASSED
  FULL
}

enum MessageStatus {
  SENT
  DELIVERED
  READ
}
